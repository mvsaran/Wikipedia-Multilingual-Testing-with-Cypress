'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
const pluginExport_1 = __importDefault(require("./pluginExport"));
const config_1 = __importDefault(require("./config"));
const server_1 = __importDefault(require("./server"));
const logger_1 = require("@applitools/logger");
const os_1 = __importDefault(require("os"));
const path_1 = __importDefault(require("path"));
const { config, eyesConfig } = (0, config_1.default)();
const logDirname = (_a = process.env.APPLITOOLS_LOG_DIR) !== null && _a !== void 0 ? _a : path_1.default.resolve(os_1.default.tmpdir(), `applitools-logs`);
const logger = (0, logger_1.makeLogger)({
    handler: { type: 'rolling file', name: 'universal', dirname: logDirname },
    level: config.showLogs ? 'info' : 'silent',
    format: { label: 'cypress-plugin' },
    maskLog: false,
});
const startServer = (0, server_1.default)({ logger, eyesConfig });
const pluginExport = (0, pluginExport_1.default)({
    startServer,
    eyesConfig: Object.assign({}, eyesConfig, { appliConfFile: config }),
});
exports.default = pluginExport;
