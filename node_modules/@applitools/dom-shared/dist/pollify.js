"use strict";
const poll = require("./poll");
function pollify(script, context, key) {
    return (options) => function (...args) {
        if (!context[key]) {
            context[key] = {};
            Promise.resolve()
                .then(() => script(...args))
                .then(value => (context[key].value = value))
                .catch(err => (context[key].error = err.message + '\nStack:' + err.stack));
        }
        return poll(context, key, options);
    };
}
module.exports = pollify;
